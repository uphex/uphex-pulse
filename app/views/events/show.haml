- content_for :title do
  %a{:href=>params[:back]}
    %span.icon-arrow-left2
  Event Details
.mod-event-details
  %h3.client-name
    %span.icon-user
    %a{:href => "/clients/#{@event[:stream].provider.portfolio.id}"}
      #{@event[:stream].provider.portfolio.name}
  .half
    %div.event-data<
      %span.icon-clock
      - if @event[:time].seconds_since_midnight===0
        = @event[:time].strftime('%B %d, %Y')
      - else
        = @event[:time].strftime('%B %d, %Y %H:%M')
    %div.event-data
      - case @event[:type]
        - when 'positive_anomaly'
          %span.icon-thumbs-up>
          Positive anomaly
        - when 'negative_anomaly'
          %span.icon-thumbs-up2>
          Negative anomaly
        - else
          %span.icon-flag>
          Neutral event
    %div.event-data
      %img{:src => @event[:category_icon]} #{@event[:stream].provider.name}
  .half
    .sparkline-container
      %svg.mod-sparkline{"xmlns"=>"http://www.w3.org/2000/svg","data-sparkline"=>@event[:sparkline], "data-center"=>@event[:event_position_in_sparkline], "data-predictedstart"=>@event[:event_predicted_start],"data-predictedend"=>@event[:event_predicted_end],"preserveAspectRatio"=>"none"}
        %pattern{"id"=>"diagonalHatch","patternUnits"=>"userSpaceOnUse","width"=>"4","height"=>"4","patternTransform"=>"rotate(-45 2 2)"}
          %path{"d"=>"M -1,2 l 6,0", "stroke"=>"#000000","stroke-width"=>"1"}
        %g
          %path
    .result-comment
      #{@event[:event_actual] > @event[:event_predicted_end] ? '<span class="icon-arrow-up-right3"></span>'.html_safe : '<span class="icon-arrow-down-right3"></span>'.html_safe}
      %strong
        #{@event[:metric_name]}
      #{(@event[:event_actual]>@event[:event_predicted_end] ? ' up to '+((@event[:event_actual].to_d/@event[:event_predicted_end].to_d-1)*100).round.to_s+'%':'down to '+((@event[:event_actual].to_d/@event[:event_predicted_start].to_d)*100).round.to_s+'%')+' then expected'}
    %div.compare
      %div.col1 Predicted
      %strong
        #{@event[:event_predicted_start].round} - #{@event[:event_predicted_end].round}
      %div.metric #{@event[:metric_name]}
      %div.col1 Actual
      %strong
        #{@event[:event_actual].round}
      %div.metric #{@event[:metric_name]}